<div class="recruitment-container">
  <div class="page-header">
    <h2>Recruitment Management</h2>
  </div>

  <div class="dashboard-cards">
    <div class="card stat-card">
      <div class="stat-value">{{ dashboard.openRequisitions || 0 }}</div>
      <div class="stat-label">Open Requisitions</div>
    </div>
    <div class="card stat-card">
      <div class="stat-value">{{ dashboard.activePostings || 0 }}</div>
      <div class="stat-label">Active Postings</div>
    </div>
    <div class="card stat-card">
      <div class="stat-value">{{ dashboard.totalCandidates || 0 }}</div>
      <div class="stat-label">Total Candidates</div>
    </div>
    <div class="card stat-card">
      <div class="stat-value">{{ dashboard.upcomingInterviews || 0 }}</div>
      <div class="stat-label">Upcoming Interviews</div>
    </div>
  </div>

  <div class="tabs">
    <button [class.active]="activeTab === 'requisitions'" (click)="setTab('requisitions')">Requisitions</button>
    <button [class.active]="activeTab === 'postings'" (click)="setTab('postings')">Job Postings</button>
    <button [class.active]="activeTab === 'candidates'" (click)="setTab('candidates')">Candidates</button>
    <button [class.active]="activeTab === 'interviews'" (click)="setTab('interviews')">Interviews</button>
  </div>

  <div class="tab-content">
    <div *ngIf="activeTab === 'requisitions'" class="content-section">
      <div class="section-header">
        <h3>Job Requisitions</h3>
        <button class="btn btn-primary" (click)="openForm()">+ New Requisition</button>
      </div>
      <div *ngIf="loading" class="loading">Loading...</div>
      <table *ngIf="!loading" class="data-table">
        <thead>
          <tr>
            <th>Number</th>
            <th>Title</th>
            <th>Department</th>
            <th>Positions</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let req of requisitions">
            <td>{{ req.requisitionNumber }}</td>
            <td>{{ req.jobTitle }}</td>
            <td>{{ req.department?.name }}</td>
            <td>{{ req.numberOfPositions }}</td>
            <td><span class="badge" [ngClass]="getStatusClass(req.status)">{{ req.status }}</span></td>
            <td>
              <button class="btn btn-sm" (click)="openForm(req)">Edit</button>
              <button *ngIf="req.status === 'DRAFT'" class="btn btn-sm btn-primary" (click)="submitRequisition(req.id)">Submit</button>
              <button *ngIf="req.status === 'PENDING'" class="btn btn-sm btn-success" (click)="approveRequisition(req.id)">Approve</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div *ngIf="activeTab === 'postings'" class="content-section">
      <div class="section-header">
        <h3>Job Postings</h3>
        <button class="btn btn-primary" (click)="openPostingForm()">+ New Job Posting</button>
      </div>
      <div *ngIf="loading" class="loading">Loading...</div>
      <table *ngIf="!loading" class="data-table">
        <thead>
          <tr>
            <th>Code</th>
            <th>Title</th>
            <th>Location</th>
            <th>Applications</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let posting of jobPostings">
            <td>{{ posting.postingCode }}</td>
            <td>{{ posting.jobTitle }}</td>
            <td>{{ posting.location }}</td>
            <td>{{ posting.applicationCount || 0 }}</td>
            <td><span class="badge" [ngClass]="getStatusClass(posting.status)">{{ posting.status }}</span></td>
            <td>
              <button *ngIf="posting.status === 'DRAFT'" class="btn btn-sm btn-primary" (click)="publishPosting(posting.id)">Publish</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div *ngIf="activeTab === 'candidates'" class="content-section">
      <div class="section-header">
        <h3>Candidates</h3>
        <button class="btn btn-primary" (click)="openCandidateForm()">+ Add Candidate</button>
      </div>
      <div *ngIf="loading" class="loading">Loading...</div>
      <table *ngIf="!loading" class="data-table">
        <thead>
          <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Position</th>
            <th>Status</th>
            <th>Applied</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let candidate of candidates">
            <td>{{ candidate.firstName }} {{ candidate.lastName }}</td>
            <td>{{ candidate.email }}</td>
            <td>{{ candidate.jobPosting?.jobTitle }}</td>
            <td><span class="badge" [ngClass]="getStatusClass(candidate.status)">{{ candidate.status }}</span></td>
            <td>{{ formatDate(candidate.applicationDate) }}</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div *ngIf="activeTab === 'interviews'" class="content-section">
      <div class="section-header">
        <h3>Upcoming Interviews</h3>
        <button class="btn btn-primary" (click)="openInterviewForm()">+ Schedule Interview</button>
      </div>
      <div *ngIf="loading" class="loading">Loading...</div>
      <table *ngIf="!loading" class="data-table">
        <thead>
          <tr>
            <th>Candidate</th>
            <th>Position</th>
            <th>Date</th>
            <th>Type</th>
            <th>Interviewer</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let interview of interviews">
            <td>{{ interview.candidate?.firstName }} {{ interview.candidate?.lastName }}</td>
            <td>{{ interview.candidate?.jobPosting?.jobTitle }}</td>
            <td>{{ formatDate(interview.scheduledDate) }}</td>
            <td>{{ interview.interviewType }}</td>
            <td>{{ interview.interviewer?.firstName }} {{ interview.interviewer?.lastName }}</td>
            <td><span class="badge" [ngClass]="getStatusClass(interview.status)">{{ interview.status }}</span></td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <div *ngIf="showForm" class="modal-overlay" (click)="closeForm()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <h3>{{ editingItem ? 'Edit' : 'New' }} Requisition</h3>
      <form (ngSubmit)="saveRequisition()">
        <div class="form-group">
          <label>Job Title</label>
          <input type="text" [(ngModel)]="formData.jobTitle" name="jobTitle" required>
        </div>
        <div class="form-group">
          <label>Number of Positions</label>
          <input type="number" [(ngModel)]="formData.numberOfPositions" name="numberOfPositions" min="1">
        </div>
        <div class="form-group">
          <label>Employment Type</label>
          <select [(ngModel)]="formData.employmentType" name="employmentType">
            <option value="FULL_TIME">Full Time</option>
            <option value="PART_TIME">Part Time</option>
            <option value="CONTRACT">Contract</option>
          </select>
        </div>
        <div class="form-group">
          <label>Description</label>
          <textarea [(ngModel)]="formData.jobDescription" name="jobDescription" rows="4"></textarea>
        </div>
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" (click)="closeForm()">Cancel</button>
          <button type="submit" class="btn btn-primary">Save</button>
        </div>
      </form>
    </div>
  </div>

  <div *ngIf="showPostingForm" class="modal-overlay" (click)="closePostingForm()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <h3>New Job Posting</h3>
      <form (ngSubmit)="saveJobPosting()">
        <div class="form-group">
          <label>Select Requisition</label>
          <select [(ngModel)]="postingData.requisitionId" name="requisitionId" required>
            <option value="">-- Select Requisition --</option>
            <option *ngFor="let req of approvedRequisitions" [value]="req.id">{{ req.positionTitle || req.jobTitle }}</option>
          </select>
        </div>
        <div class="form-group">
          <label>Posting Title</label>
          <input type="text" [(ngModel)]="postingData.title" name="title" required>
        </div>
        <div class="form-group">
          <label>Posting Type</label>
          <select [(ngModel)]="postingData.postingType" name="postingType">
            <option value="INTERNAL">Internal</option>
            <option value="EXTERNAL">External</option>
            <option value="BOTH">Both</option>
          </select>
        </div>
        <div class="form-group">
          <label>Application Deadline</label>
          <input type="date" [(ngModel)]="postingData.closeDate" name="closeDate">
        </div>
        <div class="form-group">
          <label>Description</label>
          <textarea [(ngModel)]="postingData.description" name="description" rows="4"></textarea>
        </div>
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" (click)="closePostingForm()">Cancel</button>
          <button type="submit" class="btn btn-primary">Save</button>
        </div>
      </form>
    </div>
  </div>

  <div *ngIf="showCandidateForm" class="modal-overlay" (click)="closeCandidateForm()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <h3>Add Candidate</h3>
      <form (ngSubmit)="saveCandidate()">
        <div class="form-group">
          <label>First Name</label>
          <input type="text" [(ngModel)]="candidateData.firstName" name="firstName" required>
        </div>
        <div class="form-group">
          <label>Last Name</label>
          <input type="text" [(ngModel)]="candidateData.lastName" name="lastName" required>
        </div>
        <div class="form-group">
          <label>Email</label>
          <input type="email" [(ngModel)]="candidateData.email" name="email" required>
        </div>
        <div class="form-group">
          <label>Phone</label>
          <input type="text" [(ngModel)]="candidateData.phone" name="phone">
        </div>
        <div class="form-group">
          <label>Job Posting</label>
          <select [(ngModel)]="candidateData.jobPostingId" name="jobPostingId">
            <option value="">-- Select Job Posting --</option>
            <option *ngFor="let posting of activePostings" [value]="posting.id">{{ posting.jobTitle }}</option>
          </select>
        </div>
        <div class="form-group">
          <label>Resume/Notes</label>
          <textarea [(ngModel)]="candidateData.notes" name="notes" rows="4"></textarea>
        </div>
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" (click)="closeCandidateForm()">Cancel</button>
          <button type="submit" class="btn btn-primary">Save</button>
        </div>
      </form>
    </div>
  </div>

  <div *ngIf="showInterviewForm" class="modal-overlay" (click)="closeInterviewForm()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <h3>Schedule Interview</h3>
      <form (ngSubmit)="saveInterview()">
        <div class="form-group">
          <label>Candidate</label>
          <select [(ngModel)]="interviewData.candidateId" name="candidateId" required>
            <option value="">-- Select Candidate --</option>
            <option *ngFor="let candidate of allCandidates" [value]="candidate.id">{{ candidate.firstName }} {{ candidate.lastName }}</option>
          </select>
        </div>
        <div class="form-group">
          <label>Interview Type</label>
          <select [(ngModel)]="interviewData.interviewType" name="interviewType" required>
            <option value="PHONE">Phone Screen</option>
            <option value="VIDEO">Video Call</option>
            <option value="IN_PERSON">In Person</option>
            <option value="TECHNICAL">Technical</option>
            <option value="HR">HR Round</option>
            <option value="FINAL">Final Round</option>
          </select>
        </div>
        <div class="form-group">
          <label>Interview Mode</label>
          <select [(ngModel)]="interviewData.interviewMode" name="interviewMode">
            <option value="VIRTUAL">Virtual</option>
            <option value="IN_PERSON">In Person</option>
          </select>
        </div>
        <div class="form-group">
          <label>Interview Date</label>
          <input type="date" [(ngModel)]="interviewData.interviewDate" name="interviewDate" required>
        </div>
        <div class="form-group">
          <label>Start Time</label>
          <input type="time" [(ngModel)]="interviewData.startTime" name="startTime" required>
        </div>
        <div class="form-group">
          <label>Location/Meeting Link</label>
          <input type="text" [(ngModel)]="interviewData.location" name="location" placeholder="Room number or video link">
        </div>
        <div class="form-group">
          <label>Notes</label>
          <textarea [(ngModel)]="interviewData.interviewerNotes" name="interviewerNotes" rows="3"></textarea>
        </div>
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" (click)="closeInterviewForm()">Cancel</button>
          <button type="submit" class="btn btn-primary">Schedule</button>
        </div>
      </form>
    </div>
  </div>
</div>
