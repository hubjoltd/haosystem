<div class="dashboard-container">
  <div class="dashboard-header">
    <div class="header-left">
      <h1><i class="fas fa-calendar-check"></i> Attendance Dashboard</h1>
      <p class="subtitle">Real-time attendance tracking and analysis</p>
    </div>
    <div class="header-actions">
      <select [(ngModel)]="selectedPeriod" class="period-select">
        <option value="today">Today</option>
        <option value="week">This Week</option>
        <option value="month">This Month</option>
      </select>
      <button class="btn-refresh" (click)="loadStats()">
        <i class="fas fa-sync-alt"></i>
      </button>
    </div>
  </div>

  <div *ngIf="loading" class="loading-state">
    <i class="fas fa-spinner fa-spin"></i>
    <span>Loading dashboard...</span>
  </div>

  <div *ngIf="!loading && stats" class="dashboard-content">
    <div class="stats-row">
      <div class="stat-card success">
        <div class="stat-icon"><i class="fas fa-user-check"></i></div>
        <div class="stat-info">
          <span class="stat-value">{{ stats.presentToday }}</span>
          <span class="stat-label">Present Today</span>
        </div>
        <div class="stat-badge success">{{ ((stats.presentToday / getTotalEmployees()) * 100).toFixed(1) }}%</div>
      </div>
      <div class="stat-card danger">
        <div class="stat-icon"><i class="fas fa-user-times"></i></div>
        <div class="stat-info">
          <span class="stat-value">{{ stats.absentToday }}</span>
          <span class="stat-label">Absent Today</span>
        </div>
      </div>
      <div class="stat-card warning">
        <div class="stat-icon"><i class="fas fa-bed"></i></div>
        <div class="stat-info">
          <span class="stat-value">{{ stats.onLeaveToday }}</span>
          <span class="stat-label">On Leave</span>
        </div>
      </div>
      <div class="stat-card info">
        <div class="stat-icon"><i class="fas fa-clock"></i></div>
        <div class="stat-info">
          <span class="stat-value">{{ stats.lateArrivals }}</span>
          <span class="stat-label">Late Arrivals</span>
        </div>
      </div>
      <div class="stat-card primary">
        <div class="stat-icon"><i class="fas fa-percentage"></i></div>
        <div class="stat-info">
          <span class="stat-value">{{ stats.avgAttendanceRate }}%</span>
          <span class="stat-label">Avg Attendance Rate</span>
        </div>
      </div>
    </div>

    <div class="status-summary">
      <div class="summary-bar">
        <div class="bar-segment present" [style.width.%]="(stats.presentToday / getTotalEmployees()) * 100">
          <span class="segment-label">Present</span>
        </div>
        <div class="bar-segment leave" [style.width.%]="(stats.onLeaveToday / getTotalEmployees()) * 100">
          <span class="segment-label">Leave</span>
        </div>
        <div class="bar-segment absent" [style.width.%]="(stats.absentToday / getTotalEmployees()) * 100">
          <span class="segment-label">Absent</span>
        </div>
      </div>
    </div>

    <div class="charts-row two-col">
      <div class="chart-card">
        <div class="card-header">
          <h3><i class="fas fa-chart-bar"></i> Weekly Attendance Trend</h3>
        </div>
        <div class="card-body">
          <div class="stacked-chart">
            <div class="chart-legend">
              <span class="legend-item"><span class="dot present"></span> Present</span>
              <span class="legend-item"><span class="dot leave"></span> Leave</span>
              <span class="legend-item"><span class="dot absent"></span> Absent</span>
            </div>
            <div class="stacked-bars">
              <div class="stacked-group" *ngFor="let day of stats.attendanceTrend">
                <div class="stacked-bar">
                  <div class="segment absent" [style.height.%]="(day.absent / 160) * 100"></div>
                  <div class="segment leave" [style.height.%]="(day.leave / 160) * 100"></div>
                  <div class="segment present" [style.height.%]="(day.present / 160) * 100"></div>
                </div>
                <span class="day-label">{{ day.date }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="chart-card">
        <div class="card-header">
          <h3><i class="fas fa-calendar-minus"></i> Leave Type Distribution</h3>
        </div>
        <div class="card-body">
          <div class="leave-list">
            <div class="leave-item" *ngFor="let leave of stats.leaveTypeDistribution; let i = index">
              <div class="leave-info">
                <span class="leave-icon" [style.background]="['#ffc107', '#dc3545', '#17a2b8', '#6f42c1', '#6c757d'][i]">
                  <i class="fas" [class.fa-sun]="i===0" [class.fa-thermometer-half]="i===1" 
                    [class.fa-user]="i===2" [class.fa-baby]="i===3" [class.fa-ban]="i===4"></i>
                </span>
                <span class="leave-name">{{ leave.type }}</span>
              </div>
              <div class="leave-bar-track">
                <div class="leave-bar-fill" [style.width.%]="(leave.count / getMaxLeaveCount()) * 100"
                  [style.background]="['#ffc107', '#dc3545', '#17a2b8', '#6f42c1', '#6c757d'][i]"></div>
              </div>
              <span class="leave-count">{{ leave.count }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="charts-row two-col">
      <div class="chart-card">
        <div class="card-header">
          <h3><i class="fas fa-building"></i> Department Attendance Rate</h3>
        </div>
        <div class="card-body">
          <div class="dept-attendance">
            <div class="dept-item" *ngFor="let dept of stats.departmentAttendance">
              <span class="dept-name">{{ dept.department }}</span>
              <div class="gauge-container">
                <div class="gauge-track">
                  <div class="gauge-fill" [style.width.%]="dept.rate"
                    [class.excellent]="dept.rate >= 95" [class.good]="dept.rate >= 90 && dept.rate < 95"
                    [class.fair]="dept.rate < 90"></div>
                </div>
                <span class="gauge-value">{{ dept.rate }}%</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="chart-card">
        <div class="card-header">
          <h3><i class="fas fa-clock"></i> Overtime Summary by Department</h3>
        </div>
        <div class="card-body">
          <div class="ot-summary">
            <div class="ot-total">
              <span class="ot-total-value">{{ stats.totalOvertimeHours }}</span>
              <span class="ot-total-label">Total OT Hours</span>
            </div>
            <div class="ot-breakdown">
              <div class="ot-item" *ngFor="let ot of stats.overtimeSummary">
                <span class="ot-dept">{{ ot.department }}</span>
                <div class="ot-bar-track">
                  <div class="ot-bar-fill" [style.width.%]="(ot.hours / getMaxOTHours()) * 100"></div>
                </div>
                <span class="ot-hours">{{ ot.hours }}h</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
