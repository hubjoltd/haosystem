<div class="dashboard-container">
  <div class="dashboard-header">
    <div class="header-left">
      <h1>
        <i class="fas fa-users"></i> HR Dashboard
        <span class="live-badge">
          <span class="live-dot"></span> Live
        </span>
      </h1>
      <p class="subtitle">Workforce analytics and insights</p>
    </div>
    <div class="header-actions">
      <select [(ngModel)]="selectedPeriod" class="period-select">
        <option value="week">This Week</option>
        <option value="month">This Month</option>
        <option value="quarter">This Quarter</option>
        <option value="year">This Year</option>
      </select>
      <button class="btn-refresh" (click)="loadStats()" [class.spinning]="isRefreshing">
        <i class="fas fa-sync-alt"></i>
      </button>
    </div>
  </div>

  <div *ngIf="loading" class="loading-state">
    <div class="skeleton-grid">
      <div class="skeleton-card" *ngFor="let i of [1,2,3,4,5]">
        <div class="skeleton-icon shimmer"></div>
        <div class="skeleton-text">
          <div class="skeleton-line wide shimmer"></div>
          <div class="skeleton-line narrow shimmer"></div>
        </div>
      </div>
    </div>
    <div class="skeleton-charts">
      <div class="skeleton-chart-card shimmer"></div>
      <div class="skeleton-chart-card shimmer"></div>
    </div>
  </div>

  <div *ngIf="!loading && stats" class="dashboard-content" [class.loaded]="dataLoaded">
    <div class="stats-row">
      <div class="stat-card gradient-purple animate-card">
        <div class="stat-icon"><i class="fas fa-users"></i></div>
        <div class="stat-info">
          <span class="stat-value">{{ animatedStats.totalHeadcount }}</span>
          <span class="stat-label">Total Headcount</span>
        </div>
        <div class="stat-trend up"><i class="fas fa-arrow-up"></i> 5.2%</div>
      </div>
      <div class="stat-card gradient-green animate-card">
        <div class="stat-icon"><i class="fas fa-user-check"></i></div>
        <div class="stat-info">
          <span class="stat-value">{{ animatedStats.activeEmployees }}</span>
          <span class="stat-label">Active Employees</span>
        </div>
        <div class="stat-trend up"><i class="fas fa-arrow-up"></i> 3.1%</div>
      </div>
      <div class="stat-card gradient-pink animate-card">
        <div class="stat-icon"><i class="fas fa-user-plus"></i></div>
        <div class="stat-info">
          <span class="stat-value">{{ animatedStats.newHiresThisMonth }}</span>
          <span class="stat-label">New Hires (Month)</span>
        </div>
        <div class="stat-trend up"><i class="fas fa-arrow-up"></i> 20%</div>
      </div>
      <div class="stat-card gradient-blue animate-card">
        <div class="stat-icon"><i class="fas fa-user-minus"></i></div>
        <div class="stat-info">
          <span class="stat-value">{{ animatedStats.exitsThisMonth }}</span>
          <span class="stat-label">Exits (Month)</span>
        </div>
        <div class="stat-trend down"><i class="fas fa-arrow-down"></i> 25%</div>
      </div>
      <div class="stat-card gradient-warm animate-card">
        <div class="stat-icon">
          <svg class="progress-ring" viewBox="0 0 120 120">
            <circle class="progress-ring-bg" cx="60" cy="60" r="54" />
            <circle class="progress-ring-fill" cx="60" cy="60" r="54"
              [style.stroke-dasharray]="getAttritionCircumference()"
              [style.stroke-dashoffset]="getAttritionRingOffset()" />
          </svg>
          <span class="ring-value">{{ animatedStats.attritionRate }}%</span>
        </div>
        <div class="stat-info">
          <span class="stat-value">Attrition</span>
          <span class="stat-label">Rate This Quarter</span>
        </div>
      </div>
    </div>

    <div class="charts-row">
      <div class="chart-card glass animate-card">
        <div class="card-header">
          <h3><i class="fas fa-chart-line"></i> Hiring vs Exits Trend</h3>
        </div>
        <div class="card-body">
          <div class="bar-chart">
            <div class="chart-legend">
              <span class="legend-item"><span class="dot success"></span> Hires</span>
              <span class="legend-item"><span class="dot danger"></span> Exits</span>
            </div>
            <div class="chart-bars">
              <div class="bar-group" *ngFor="let item of stats.monthlyHiringTrend; let i = index">
                <div class="bars">
                  <div class="bar hire animated-bar" [style.height.%]="(item.hires / getMaxHires()) * 100"
                    [style.animation-delay]="(i * 0.1) + 's'">
                    <span class="bar-tooltip">{{ item.hires }} hires</span>
                  </div>
                  <div class="bar exit animated-bar" [style.height.%]="(item.exits / getMaxHires()) * 100"
                    [style.animation-delay]="(i * 0.1 + 0.05) + 's'">
                    <span class="bar-tooltip">{{ item.exits }} exits</span>
                  </div>
                </div>
                <span class="bar-label">{{ item.month }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="chart-card glass animate-card">
        <div class="card-header">
          <h3><i class="fas fa-venus-mars"></i> Gender Diversity</h3>
        </div>
        <div class="card-body">
          <div class="donut-chart-container">
            <div class="donut-chart">
              <svg viewBox="0 0 100 100">
                <circle class="donut-segment male" cx="50" cy="50" r="40"
                  [style.stroke-dasharray]="getGenderPercentage('male') * 2.51 + ' 251'"
                  stroke-dashoffset="0" />
                <circle class="donut-segment female" cx="50" cy="50" r="40"
                  [style.stroke-dasharray]="getGenderPercentage('female') * 2.51 + ' 251'"
                  [style.stroke-dashoffset]="'-' + (getGenderPercentage('male') * 2.51)" />
                <circle class="donut-segment other" cx="50" cy="50" r="40"
                  [style.stroke-dasharray]="getGenderPercentage('other') * 2.51 + ' 251'"
                  [style.stroke-dashoffset]="'-' + ((getGenderPercentage('male') + getGenderPercentage('female')) * 2.51)" />
              </svg>
              <div class="donut-center">
                <span class="total">{{ animatedStats.totalHeadcount }}</span>
                <span class="label">Total</span>
              </div>
            </div>
            <div class="donut-legend">
              <div class="legend-item">
                <span class="dot male"></span>
                <span class="label">Male</span>
                <span class="value">{{ stats.genderDiversity.male }} ({{ getGenderPercentage('male') }}%)</span>
              </div>
              <div class="legend-item">
                <span class="dot female"></span>
                <span class="label">Female</span>
                <span class="value">{{ stats.genderDiversity.female }} ({{ getGenderPercentage('female') }}%)</span>
              </div>
              <div class="legend-item">
                <span class="dot other"></span>
                <span class="label">Other</span>
                <span class="value">{{ stats.genderDiversity.other }} ({{ getGenderPercentage('other') }}%)</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="charts-row three-col">
      <div class="chart-card glass animate-card">
        <div class="card-header">
          <h3><i class="fas fa-building"></i> Department Distribution</h3>
        </div>
        <div class="card-body">
          <div class="horizontal-bars">
            <div class="h-bar-item" *ngFor="let dept of stats.departmentDistribution; let i = index">
              <span class="h-bar-label">{{ dept.department }}</span>
              <div class="h-bar-track">
                <div class="h-bar-fill animated-bar-h" [style.width.%]="(dept.count / getMaxDepartmentCount()) * 100"
                  [style.animation-delay]="(i * 0.1) + 's'">
                </div>
              </div>
              <span class="h-bar-value">{{ dept.count }}</span>
            </div>
          </div>
        </div>
      </div>

      <div class="chart-card glass animate-card">
        <div class="card-header">
          <h3><i class="fas fa-birthday-cake"></i> Age Distribution</h3>
        </div>
        <div class="card-body">
          <div class="age-chart">
            <div class="age-bar" *ngFor="let age of stats.ageDistribution; let i = index">
              <div class="age-bar-fill animated-bar" [style.height.%]="(age.count / 70) * 100"
                [style.animation-delay]="(i * 0.12) + 's'">
                <span class="bar-tooltip">{{ age.count }}</span>
              </div>
              <span class="age-count">{{ age.count }}</span>
              <span class="age-label">{{ age.range }}</span>
            </div>
          </div>
        </div>
      </div>

      <div class="chart-card glass small animate-card">
        <div class="card-header">
          <h3><i class="fas fa-briefcase"></i> Employment Types</h3>
        </div>
        <div class="card-body">
          <div class="type-list">
            <div class="type-item" *ngFor="let type of stats.employmentTypeDistribution">
              <div class="type-info">
                <span class="type-name">{{ type.type }}</span>
                <span class="type-count">{{ type.count }}</span>
              </div>
              <div class="type-bar-track">
                <div class="type-bar-fill" [style.width.%]="(type.count / stats.totalHeadcount) * 100"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="metrics-row">
      <div class="metric-card glass animate-card">
        <div class="metric-icon-wrap">
          <i class="fas fa-clock"></i>
        </div>
        <div class="metric-content">
          <span class="metric-value">{{ animatedStats.avgTenure }} yrs</span>
          <span class="metric-label">Average Tenure</span>
        </div>
      </div>
      <div class="metric-card glass animate-card">
        <div class="metric-icon-wrap">
          <i class="fas fa-bed"></i>
        </div>
        <div class="metric-content">
          <span class="metric-value">{{ animatedStats.onLeave }}</span>
          <span class="metric-label">On Leave Today</span>
        </div>
      </div>
      <div class="metric-card glass animate-card">
        <div class="metric-icon-wrap">
          <i class="fas fa-chart-pie"></i>
        </div>
        <div class="metric-content">
          <span class="metric-value">{{ stats.departmentDistribution.length }}</span>
          <span class="metric-label">Departments</span>
        </div>
      </div>
    </div>

    <div class="activity-section animate-card">
      <div class="card-header">
        <h3><i class="fas fa-stream"></i> Recent Activity</h3>
      </div>
      <div class="activity-feed">
        <div class="activity-item" *ngFor="let activity of recentActivities; let i = index"
          [style.animation-delay]="(i * 0.08) + 's'">
          <div class="activity-dot" [ngClass]="activity.type"></div>
          <div class="activity-icon" [ngClass]="activity.type">
            <i [class]="activity.icon"></i>
          </div>
          <div class="activity-content">
            <p class="activity-message">{{ activity.message }}</p>
            <span class="activity-time">{{ activity.time }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
