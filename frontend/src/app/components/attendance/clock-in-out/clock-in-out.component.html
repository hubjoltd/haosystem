<div class="time-clock-container">
  <div class="page-header">
    <h1>Time Clock</h1>
    <p class="subtitle">Clock in and out for your shift</p>
  </div>

  <div *ngIf="message" class="alert" [class.success]="messageType === 'success'" [class.error]="messageType === 'error'">
    {{ message }}
  </div>

  <div class="main-content">
    <div class="left-panel">
      <div class="date-time-card">
        <div class="calendar-icon">
          <i class="fas fa-calendar-alt"></i>
        </div>
        <div class="date-display">{{ formatDate(currentTime) }}</div>
        <div class="time-label">Current Time</div>
        <div class="time-display">{{ formatTime(currentTime) }}</div>
      </div>

      <div class="employee-section">
        <div class="section-header">
          <i class="fas fa-user"></i>
          <span>Select Employee</span>
        </div>
        
        <select [(ngModel)]="selectedEmployeeId" (ngModelChange)="onEmployeeChange()" class="employee-select">
          <option [ngValue]="null">-- Select Employee --</option>
          <option *ngFor="let emp of employees" [ngValue]="emp.id">
            {{ emp.firstName }} {{ emp.lastName }}
          </option>
        </select>

        <div class="selected-employee-card" *ngIf="selectedEmployee">
          <div class="employee-avatar">{{ getEmployeeInitials(selectedEmployee) }}</div>
          <div class="employee-details">
            <span class="employee-name">{{ selectedEmployee.firstName }} {{ selectedEmployee.lastName }}</span>
            <span class="employee-role">{{ selectedEmployee.designation?.title || selectedEmployee.jobRole?.title || 'Employee' }}</span>
            <span class="hourly-rate" *ngIf="getHourlyRate() > 0">
              <i class="fas fa-dollar-sign"></i> ${{ getHourlyRate().toFixed(2) }}/hr
            </span>
          </div>
        </div>

        <div class="timer-section" *ngIf="selectedEmployee">
          <div class="timer-card" [class.active]="isClockedIn()">
            <div class="timer-header">
              <i class="fas fa-stopwatch"></i>
              <span>{{ isClockedIn() ? 'Time Elapsed' : 'Timer' }}</span>
            </div>
            <div class="timer-display" [class.running]="isClockedIn()">
              {{ elapsedTime }}
            </div>
            <div class="earnings-display" *ngIf="isClockedIn() && getHourlyRate() > 0">
              <span class="earnings-label">Current Earnings:</span>
              <span class="earnings-amount">${{ currentEarnings.toFixed(2) }}</span>
            </div>
          </div>
          
          <div class="session-summary" *ngIf="showSessionSummary">
            <div class="summary-header">
              <i class="fas fa-check-circle"></i>
              <span>Session Complete</span>
            </div>
            <div class="summary-details">
              <div class="summary-row">
                <span class="label">Hours Worked:</span>
                <span class="value">{{ formatHoursMinutes(lastSessionHours) }}</span>
              </div>
              <div class="summary-row">
                <span class="label">Hourly Rate:</span>
                <span class="value">${{ getHourlyRate().toFixed(2) }}</span>
              </div>
              <div class="summary-row total">
                <span class="label">Total Earned:</span>
                <span class="value">${{ lastSessionEarnings.toFixed(2) }}</span>
              </div>
            </div>
          </div>
        </div>

        <div class="clock-buttons">
          <button class="btn-clock-in" (click)="clockIn()" [disabled]="loading || loadingRecord || !selectedEmployeeId || isClockedIn()">
            <i class="fas fa-play-circle" *ngIf="!loading && !loadingRecord"></i>
            <i class="fas fa-spinner fa-spin" *ngIf="loading || loadingRecord"></i>
            Clock In
          </button>
          <button class="btn-clock-out" (click)="clockOut()" [disabled]="loading || loadingRecord || !selectedEmployeeId || !isClockedIn()">
            <i class="fas fa-stop-circle" *ngIf="!loading && !loadingRecord"></i>
            <i class="fas fa-spinner fa-spin" *ngIf="loading || loadingRecord"></i>
            Clock Out
          </button>
        </div>
      </div>
    </div>

    <div class="right-panel">
      <div class="activity-section">
        <div class="section-header">
          <i class="fas fa-clock"></i>
          <span>Today's Activity</span>
        </div>

        <div class="activity-list" *ngIf="todayActivities.length > 0">
          <div class="activity-item" *ngFor="let record of todayActivities">
            <div class="activity-avatar">{{ getEmployeeInitials(record) }}</div>
            <div class="activity-details">
              <span class="activity-name">{{ getEmployeeName(record) }}</span>
              <div class="activity-times">
                <span class="time-badge in"><i class="fas fa-sign-in-alt"></i> {{ record.clockIn || '-' }}</span>
                <span class="time-badge out"><i class="fas fa-sign-out-alt"></i> {{ record.clockOut || '-' }}</span>
                <span class="duration"><i class="fas fa-hourglass-half"></i> {{ calculateDuration(record) }}</span>
              </div>
              <div class="activity-earnings" *ngIf="record.clockOut && calculateEarnings(record) > 0">
                <i class="fas fa-dollar-sign"></i> Earned: ${{ calculateEarnings(record).toFixed(2) }}
              </div>
            </div>
            <div class="activity-actions">
              <button 
                *ngIf="record.clockIn && !record.clockOut" 
                class="btn-quick-clock-out" 
                (click)="quickClockOut(record)"
                [disabled]="loading">
                <i class="fas fa-stop-circle"></i> Clock Out
              </button>
              <div class="activity-status" [ngClass]="getActivityStatus(record).toLowerCase()" *ngIf="record.clockOut || !record.clockIn">
                {{ getActivityStatus(record) }}
              </div>
            </div>
          </div>
        </div>

        <div class="no-activity" *ngIf="todayActivities.length === 0">
          <i class="fas fa-calendar-times"></i>
          <p>No activity recorded today</p>
        </div>
      </div>
    </div>
  </div>
</div>
