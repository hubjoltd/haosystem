<div class="leave-requests-container">
  <div class="page-header">
    <div class="header-left">
      <h1><i class="fas fa-calendar-check"></i> Leave Requests</h1>
      <p class="subtitle">Manage leave applications and approvals</p>
    </div>
    <button class="btn-primary" (click)="openCreateModal()">
      <i class="fas fa-plus"></i> New Request
    </button>
  </div>

  <div class="filters-bar">
    <div class="search-box">
      <i class="fas fa-search"></i>
      <input type="text" placeholder="Search by employee or leave type..." [(ngModel)]="searchTerm" (ngModelChange)="filterRequests()">
    </div>
    <div class="status-tabs">
      <button [class.active]="statusFilter === 'ALL'" (click)="statusFilter = 'ALL'; filterRequests()">All</button>
      <button [class.active]="statusFilter === 'PENDING'" (click)="statusFilter = 'PENDING'; filterRequests()">Pending</button>
      <button [class.active]="statusFilter === 'APPROVED'" (click)="statusFilter = 'APPROVED'; filterRequests()">Approved</button>
      <button [class.active]="statusFilter === 'REJECTED'" (click)="statusFilter = 'REJECTED'; filterRequests()">Rejected</button>
    </div>
  </div>

  <div class="requests-table" *ngIf="!loading && filteredRequests.length > 0">
    <table>
      <thead>
        <tr>
          <th>Employee</th>
          <th>Leave Type</th>
          <th>From</th>
          <th>To</th>
          <th>Days</th>
          <th>Reason</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let req of filteredRequests">
          <td>
            <div class="employee-info">
              <div class="avatar">{{ req.employee?.firstName?.charAt(0) || '?' }}</div>
              <span>{{ req.employee?.firstName }} {{ req.employee?.lastName }}</span>
            </div>
          </td>
          <td>
            <span class="leave-type" [style.border-left-color]="req.leaveType?.colorCode || '#008080'">
              {{ req.leaveType?.name || 'N/A' }}
            </span>
          </td>
          <td>{{ formatDate(req.startDate) }}</td>
          <td>{{ formatDate(req.endDate) }}</td>
          <td>{{ req.totalDays }}</td>
          <td class="reason-cell">{{ req.reason || '-' }}</td>
          <td>
            <span class="status-badge" [class]="getStatusClass(req.status || '')">{{ req.status }}</span>
          </td>
          <td>
            <div class="action-buttons">
              <button class="btn-icon approve" *ngIf="req.status === 'PENDING'" (click)="openApprovalModal(req)" title="Review">
                <i class="fas fa-check-circle"></i>
              </button>
              <button class="btn-icon cancel" *ngIf="req.status === 'PENDING'" (click)="cancelRequest(req.id!)" title="Cancel">
                <i class="fas fa-times-circle"></i>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="empty-state" *ngIf="!loading && filteredRequests.length === 0">
    <i class="fas fa-calendar-times"></i>
    <p>No leave requests found</p>
  </div>

  <div class="modal-overlay" *ngIf="showModal" (click)="closeModal()">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>New Leave Request</h2>
        <button class="btn-close" (click)="closeModal()"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>Leave Type *</label>
          <select [(ngModel)]="formData.leaveTypeId">
            <option [value]="null">-- Select Leave Type --</option>
            <option *ngFor="let lt of leaveTypes" [value]="lt.id">{{ lt.name }} ({{ lt.annualEntitlement }} days)</option>
          </select>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Start Date *</label>
            <input type="date" [(ngModel)]="formData.startDate">
          </div>
          <div class="form-group">
            <label>End Date *</label>
            <input type="date" [(ngModel)]="formData.endDate">
          </div>
        </div>
        <div class="form-group">
          <label>Day Type</label>
          <select [(ngModel)]="formData.dayType">
            <option value="FULL_DAY">Full Day</option>
            <option value="HALF_DAY_AM">Half Day (Morning)</option>
            <option value="HALF_DAY_PM">Half Day (Afternoon)</option>
          </select>
        </div>
        <div class="form-group">
          <label>Reason *</label>
          <textarea [(ngModel)]="formData.reason" rows="3" placeholder="Please provide reason for leave..."></textarea>
        </div>
        <div class="form-group">
          <label>Emergency Contact</label>
          <input type="text" [(ngModel)]="formData.emergencyContact" placeholder="Phone number">
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" (click)="closeModal()">Cancel</button>
        <button class="btn-primary" (click)="submitRequest()">Submit Request</button>
      </div>
    </div>
  </div>

  <div class="modal-overlay" *ngIf="showApprovalModal" (click)="closeApprovalModal()">
    <div class="modal approval-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Review Leave Request</h2>
        <button class="btn-close" (click)="closeApprovalModal()"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-body" *ngIf="selectedRequest">
        <div class="request-summary">
          <div class="summary-item">
            <span class="label">Employee</span>
            <span class="value">{{ selectedRequest.employee?.firstName }} {{ selectedRequest.employee?.lastName }}</span>
          </div>
          <div class="summary-item">
            <span class="label">Leave Type</span>
            <span class="value">{{ selectedRequest.leaveType?.name }}</span>
          </div>
          <div class="summary-item">
            <span class="label">Duration</span>
            <span class="value">{{ formatDate(selectedRequest.startDate) }} - {{ formatDate(selectedRequest.endDate) }} ({{ selectedRequest.totalDays }} days)</span>
          </div>
          <div class="summary-item">
            <span class="label">Reason</span>
            <span class="value">{{ selectedRequest.reason }}</span>
          </div>
        </div>
        <div class="form-group">
          <label>Remarks</label>
          <textarea [(ngModel)]="approverRemarks" rows="3" placeholder="Add any comments..."></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-reject" (click)="rejectRequest()">
          <i class="fas fa-times"></i> Reject
        </button>
        <button class="btn-approve" (click)="approveRequest()">
          <i class="fas fa-check"></i> Approve
        </button>
      </div>
    </div>
  </div>
</div>
