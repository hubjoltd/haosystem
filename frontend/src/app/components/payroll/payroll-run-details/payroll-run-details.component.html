<div class="payroll-details-container">
  <div class="page-header">
    <button class="btn-back" (click)="goBack()" title="Go back">
      <i class="fas fa-arrow-left"></i> Back
    </button>
    <h2>Payroll Run Details</h2>
  </div>

  <div *ngIf="!loading && payrollRun" class="run-summary">
    <div class="summary-card">
      <span class="label">Payroll Run:</span>
      <span class="value">{{ payrollRun.payrollRunNumber }}</span>
    </div>
    <div class="summary-card">
      <span class="label">Period:</span>
      <span class="value">{{ payrollRun.periodStartDate | date:'MMM d, yyyy' }} - {{ payrollRun.periodEndDate | date:'MMM d, yyyy' }}</span>
    </div>
    <div class="summary-card">
      <span class="label">Pay Date:</span>
      <span class="value">{{ payrollRun.payDate | date:'MMM d, yyyy' }}</span>
    </div>
    <div class="summary-card">
      <span class="label">Status:</span>
      <span class="value badge" [ngClass]="payrollRun.status?.toLowerCase()">{{ payrollRun.status }}</span>
    </div>
  </div>

  <div *ngIf="loading" class="loading-state">
    <i class="fas fa-spinner fa-spin"></i>
    <p>Loading payroll details...</p>
  </div>

  <div *ngIf="!loading && payrollRecords.length > 0" class="employees-section">
    <div class="section-header">
      <h3><i class="fas fa-users"></i> Employees ({{ payrollRecords.length }})</h3>
      <div class="selection-info">
        <span class="selected-count">Selected: {{ getSelectedCount() }} / {{ payrollRecords.length }}</span>
      </div>
    </div>

    <div class="table-container">
      <table class="employees-table">
        <thead>
          <tr>
            <th class="checkbox-col">
              <input type="checkbox" [(ngModel)]="selectAll" (change)="toggleSelectAll()" title="Select all">
            </th>
            <th>Employee Name</th>
            <th>Code</th>
            <th class="text-right">Gross Pay</th>
            <th class="text-right">Deductions</th>
            <th class="text-right">Taxes</th>
            <th class="text-right">Net Pay</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let record of payrollRecords" [ngClass]="{'selected': selectedRecords.get(record.id || 0)}">
            <td class="checkbox-col">
              <input type="checkbox" 
                     [checked]="selectedRecords.get(record.id || 0)" 
                     (change)="toggleRecord(record.id || 0)"
                     title="Select employee">
            </td>
            <td class="employee-name">{{ getEmployeeName(record) }}</td>
            <td class="employee-code">{{ getEmployeeCode(record) }}</td>
            <td class="amount text-right gross">{{ formatCurrency(record.grossPay || 0) }}</td>
            <td class="amount text-right deduction">{{ formatCurrency(record.totalDeductions || 0) }}</td>
            <td class="amount text-right tax">{{ formatCurrency(record.totalTaxes || 0) }}</td>
            <td class="amount text-right net">{{ formatCurrency(record.netPay || 0) }}</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="action-buttons">
      <button class="btn btn-secondary" (click)="goBack()">
        <i class="fas fa-times"></i> Cancel
      </button>
      <button class="btn btn-primary" (click)="processPayroll()" 
              [disabled]="getSelectedCount() === 0 || processing">
        <i class="fas fa-check"></i> {{ processing ? 'Processing...' : 'Process Selected' }}
      </button>
    </div>
  </div>

  <div *ngIf="!loading && payrollRecords.length === 0" class="empty-state">
    <i class="fas fa-inbox"></i>
    <p>No payroll records found for this run</p>
  </div>
</div>
