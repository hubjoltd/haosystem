<div class="attendance-payroll-approval">
  <div class="page-header">
    <div class="header-left">
      <h1>Attendance & Payroll Approval</h1>
      <p class="subtitle">Approved attendance data and payroll processing</p>
    </div>
    <div class="header-actions">
      <button class="btn btn-outline-primary" (click)="goToStep(5)">
        <i class="fas fa-history"></i> View Payroll History
      </button>
    </div>
  </div>

  <div class="message-bar" *ngIf="message" [ngClass]="messageType">
    {{ message }}
  </div>

  <div class="step-wizard-new">
    <div class="step-item" [class.active]="currentStep === 0" [class.completed]="currentStep > 0" (click)="goToStep(0)">
      <div class="step-circle">
        <i class="fas" [ngClass]="currentStep > 0 ? 'fa-check' : 'fa-clipboard-check'"></i>
      </div>
      <div class="step-line" [class.completed]="currentStep > 0"></div>
      <div class="step-text">
        <span class="step-number">Step 1:</span>
        <span class="step-title">Approved Attendance</span>
      </div>
    </div>

    <div class="step-item" [class.active]="currentStep === 1" [class.completed]="currentStep > 1" (click)="goToStep(1)">
      <div class="step-circle">
        <i class="fas" [ngClass]="currentStep > 1 ? 'fa-check' : 'fa-file-alt'"></i>
      </div>
      <div class="step-line" [class.completed]="currentStep > 1"></div>
      <div class="step-text">
        <span class="step-number">Step 2:</span>
        <span class="step-title">Generate Timesheets</span>
      </div>
    </div>

    <div class="step-item" [class.active]="currentStep === 2" [class.completed]="currentStep > 2" (click)="goToStep(2)">
      <div class="step-circle">
        <i class="fas" [ngClass]="currentStep > 2 ? 'fa-check' : 'fa-dollar-sign'"></i>
      </div>
      <div class="step-line" [class.completed]="currentStep > 2"></div>
      <div class="step-text">
        <span class="step-number">Step 3:</span>
        <span class="step-title">Calculate Payroll</span>
      </div>
    </div>

    <div class="step-item" [class.active]="currentStep === 3" [class.completed]="currentStep > 3" (click)="goToStep(3)">
      <div class="step-circle">
        <i class="fas" [ngClass]="currentStep > 3 ? 'fa-check' : 'fa-cog'"></i>
      </div>
      <div class="step-line" [class.completed]="currentStep > 3"></div>
      <div class="step-text">
        <span class="step-number">Step 4:</span>
        <span class="step-title">Process Payroll</span>
      </div>
    </div>

    <div class="step-item" [class.active]="currentStep === 4" (click)="goToStep(5)">
      <div class="step-circle">
        <i class="fas fa-history"></i>
      </div>
      <div class="step-text">
        <span class="step-number">Step 5:</span>
        <span class="step-title">Payroll History</span>
      </div>
    </div>
  </div>

  <!-- Step 1: Approved Attendance (Auto-Load) -->
  <div class="step-content" *ngIf="currentStep === 0">
    <div class="section-box">
      <div class="step-header">
        <h3>Step 1: Approved Attendance Data</h3>
        <p class="period-info">Showing approved attendance records</p>
      </div>

      <div class="form-grid compact">
        <div class="form-group">
          <label>Start Date</label>
          <input type="date" [(ngModel)]="approvedStartDate" (change)="onApprovedDateChange()" />
        </div>
        <div class="form-group">
          <label>End Date</label>
          <input type="date" [(ngModel)]="approvedEndDate" (change)="onApprovedDateChange()" />
        </div>
      </div>

      <div class="summary-stats-row">
        <div class="stat-box blue">
          <div class="stat-icon"><i class="fas fa-users"></i></div>
          <div class="stat-info">
            <span class="stat-label">Employees</span>
            <span class="stat-value">{{ totalApprovedEmployees }}</span>
          </div>
        </div>
        <div class="stat-box green">
          <div class="stat-icon"><i class="fas fa-calendar-check"></i></div>
          <div class="stat-info">
            <span class="stat-label">Records</span>
            <span class="stat-value">{{ totalApprovedRecords }}</span>
          </div>
        </div>
        <div class="stat-box purple">
          <div class="stat-icon"><i class="fas fa-clock"></i></div>
          <div class="stat-info">
            <span class="stat-label">Total Hours</span>
            <span class="stat-value">{{ totalApprovedHours.toFixed(1) }}h</span>
          </div>
        </div>
        <div class="stat-box orange">
          <div class="stat-icon"><i class="fas fa-hourglass-half"></i></div>
          <div class="stat-info">
            <span class="stat-label">Overtime</span>
            <span class="stat-value">{{ totalApprovedOT.toFixed(1) }}h</span>
          </div>
        </div>
      </div>

      <div class="sub-section">
        <h4><i class="fas fa-check-circle"></i> Approved Attendance Records</h4>
      </div>

      <div class="loading-indicator" *ngIf="loading">
        <i class="fas fa-spinner fa-spin"></i> Loading approved attendance...
      </div>

      <div class="table-container" *ngIf="!loading">
        <table class="data-table">
          <thead>
            <tr>
              <th>#</th>
              <th>EMP ID</th>
              <th>NAME</th>
              <th>DEPARTMENT</th>
              <th>DATE</th>
              <th>CLOCK IN</th>
              <th>CLOCK OUT</th>
              <th>HOURS</th>
              <th>OT</th>
              <th>STATUS</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let record of approvedAttendanceRecords; let i = index">
              <td>{{ i + 1 }}</td>
              <td class="emp-id"><a class="employee-code-link" [routerLink]="['/app/hr/employees', record.employeeId]">{{ record.employeeCode }}</a></td>
              <td class="emp-name">{{ record.employeeName }}</td>
              <td>{{ record.department }}</td>
              <td>{{ formatDateDisplay(record.attendanceDate) }}</td>
              <td>{{ record.clockIn?.substring(0, 5) || '-' }}</td>
              <td>{{ record.clockOut?.substring(0, 5) || '-' }}</td>
              <td class="hours">{{ record.regularHours.toFixed(1) }}</td>
              <td class="hours">{{ record.overtimeHours.toFixed(1) }}</td>
              <td>
                <span class="status-badge approved">{{ record.status }}</span>
              </td>
            </tr>
            <tr *ngIf="approvedAttendanceRecords.length === 0 && !loading">
              <td colspan="10" class="no-data">
                <i class="fas fa-calendar-times"></i>
                No approved attendance records found for this period
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="step-actions-bar">
        <div class="left-actions">
          <span class="selected-info">{{ approvedAttendanceRecords.length }} approved records</span>
        </div>
        <div class="right-actions">
          <button class="btn btn-primary" (click)="goToStep(1)">
            Next: Generate Timesheets <i class="fas fa-arrow-right"></i>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Step 2: Generate Timesheet -->
  <div class="step-content" *ngIf="currentStep === 1">
    <div class="section-box">
      <div class="step-header">
        <h3>Step 2: Generate Timesheet Summary</h3>
        <p class="period-info">Period: {{ generateStartDate }} - {{ generateEndDate }} ({{ getPayPeriodTypeLabel() }})</p>
      </div>

      <div class="form-grid compact">
        <div class="form-group">
          <label>Pay Period Type</label>
          <select [(ngModel)]="selectedPayPeriodType" (change)="onPayPeriodTypeChange()">
            <option value="MONTHLY">Monthly</option>
            <option value="WEEKLY">Weekly</option>
            <option value="BI_WEEKLY">Bi-Weekly</option>
            <option value="SEMI_MONTHLY">Semi-Monthly</option>
          </select>
        </div>
        <div class="form-group">
          <label>Period Start</label>
          <input type="date" [(ngModel)]="generateStartDate" />
        </div>
        <div class="form-group">
          <label>Period End</label>
          <input type="date" [(ngModel)]="generateEndDate" />
        </div>
        <div class="form-group" style="display: flex; align-items: flex-end;">
          <button class="btn btn-success" [disabled]="generating" (click)="generateTimesheetsForPeriod()">
            <i class="fas fa-sync" [class.fa-spin]="generating"></i>
            {{ generating ? 'Generating...' : 'Generate Timesheets' }}
          </button>
        </div>
      </div>

      <div class="sub-section">
        <h4><i class="fas fa-file-alt"></i> Generated Timesheets</h4>
      </div>

      <div class="loading-indicator" *ngIf="generating">
        <i class="fas fa-spinner fa-spin"></i> Generating timesheets from approved attendance...
      </div>

      <div class="table-container" *ngIf="!generating">
        <table class="data-table generated-timesheet-table">
          <thead>
            <tr>
              <th>#</th>
              <th>EMP ID</th>
              <th>FIRST NAME</th>
              <th>LAST NAME</th>
              <th>DEPARTMENT</th>
              <th>REG HOURS</th>
              <th>OT HOURS</th>
              <th>TOTAL HOURS</th>
              <th>STATUS</th>
              <th>ACTION</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let ts of generatedTimesheets; let i = index" [class.processed-row]="isEmployeeAlreadyProcessed(ts.employeeId)">
              <td>{{ i + 1 }}</td>
              <td class="emp-id">{{ ts.employeeCode }}</td>
              <td class="emp-name">{{ ts.firstName }}</td>
              <td class="emp-name">{{ ts.lastName }}</td>
              <td>{{ ts.department }}</td>
              <td class="hours">{{ ts.totalRegularHours.toFixed(1) }}</td>
              <td class="hours">{{ ts.totalOvertimeHours.toFixed(1) }}</td>
              <td class="hours total">{{ ts.totalHours.toFixed(1) }}</td>
              <td>
                <span class="status-badge" [ngClass]="{
                  'approved': !isEmployeeAlreadyProcessed(ts.employeeId),
                  'processed': getEmployeePayrollStatus(ts.employeeId) === 'Processed',
                  'released': getEmployeePayrollStatus(ts.employeeId) === 'Released'
                }">
                  {{ isEmployeeAlreadyProcessed(ts.employeeId) ? getEmployeePayrollStatus(ts.employeeId) : ts.status }}
                </span>
              </td>
              <td class="action-col">
                <button class="btn btn-sm btn-info" (click)="viewTimesheet(ts)" title="View Timesheet">
                  <i class="fas fa-eye"></i> View
                </button>
                <button class="btn btn-sm btn-primary" (click)="downloadTimesheetPDF(ts)" title="Download PDF">
                  <i class="fas fa-file-pdf"></i> PDF
                </button>
              </td>
            </tr>
            <tr *ngIf="generatedTimesheets.length === 0 && !generating">
              <td colspan="10" class="no-data">
                <i class="fas fa-file-alt"></i>
                No timesheets generated yet. Click "Generate Timesheets" to create from approved attendance.
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="step-actions-bar">
        <div class="left-actions">
          <span class="selected-info">{{ generatedTimesheets.length }} timesheets generated</span>
        </div>
        <div class="right-actions">
          <button class="btn btn-outline-secondary" (click)="goToStep(0)">
            <i class="fas fa-arrow-left"></i> Back
          </button>
          <button class="btn btn-primary" (click)="goToStep(2)">
            Next: Calculate Payroll <i class="fas fa-arrow-right"></i>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Individual Timesheet Modal -->
  <div class="modal-overlay" *ngIf="showTimesheetModal" (click)="closeTimesheetModal()">
    <div class="modal-content timesheet-modal" (click)="$event.stopPropagation()">
      <div class="modal-header blue-header">
        <h3>Individual Timesheet</h3>
        <button class="close-btn" (click)="closeTimesheetModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <div class="employee-info-bar" *ngIf="selectedTimesheetEmployee">
          <div class="info-item">
            <span class="label">Employee ID:</span>
            <span class="value">{{ selectedTimesheetEmployee.employeeCode }}</span>
          </div>
          <div class="info-item">
            <span class="label">Name:</span>
            <span class="value">{{ selectedTimesheetEmployee.firstName }} {{ selectedTimesheetEmployee.lastName }}</span>
          </div>
          <div class="info-item">
            <span class="label">Department:</span>
            <span class="value">{{ selectedTimesheetEmployee.department }}</span>
          </div>
          <div class="info-item">
            <span class="label">Period:</span>
            <span class="value">{{ generateStartDate }} - {{ generateEndDate }}</span>
          </div>
        </div>
        
        <table class="data-table individual-timesheet-table">
          <thead>
            <tr>
              <th>S.No</th>
              <th>Date</th>
              <th>Day</th>
              <th>Clock In</th>
              <th>Clock Out</th>
              <th>Lunch Hour</th>
              <th>Reg Hours</th>
              <th>OT Hours</th>
              <th>Total Hours</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let row of individualTimesheetRows">
              <td>{{ row.sno }}</td>
              <td>{{ row.date }}</td>
              <td>{{ row.day }}</td>
              <td>{{ row.clockIn?.substring(0, 5) || '-' }}</td>
              <td>{{ row.clockOut?.substring(0, 5) || '-' }}</td>
              <td>1:00</td>
              <td class="hours">{{ row.regHours.toFixed(1) }}</td>
              <td class="hours">{{ row.otHours.toFixed(1) }}</td>
              <td class="hours total">{{ row.totalHours.toFixed(1) }}</td>
              <td>
                <span class="status-badge approved">{{ row.status }}</span>
              </td>
            </tr>
          </tbody>
          <tfoot *ngIf="selectedTimesheetEmployee">
            <tr class="summary-row">
              <td colspan="6" class="text-right"><strong>TOTALS:</strong></td>
              <td class="hours"><strong>{{ selectedTimesheetEmployee.totalRegularHours.toFixed(1) }}</strong></td>
              <td class="hours"><strong>{{ selectedTimesheetEmployee.totalOvertimeHours.toFixed(1) }}</strong></td>
              <td class="hours total"><strong>{{ selectedTimesheetEmployee.totalHours.toFixed(1) }}</strong></td>
              <td></td>
            </tr>
          </tfoot>
        </table>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline-secondary" (click)="closeTimesheetModal()">Close</button>
        <button class="btn btn-primary" (click)="downloadTimesheetPDF(selectedTimesheetEmployee!)" *ngIf="selectedTimesheetEmployee">
          <i class="fas fa-file-pdf"></i> Download PDF
        </button>
      </div>
    </div>
  </div>

  <!-- Step 3: Calculate Payroll -->
  <div class="step-content" *ngIf="currentStep === 2">
    <div class="section-box">
      <div class="payroll-summary-cards">
        <div class="payroll-card green">
          <span class="card-label">Total Gross Pay</span>
          <span class="card-value">{{ formatCurrency(step3TotalGross) }}</span>
        </div>
        <div class="payroll-card red">
          <span class="card-label">Total Taxes</span>
          <span class="card-value">{{ formatCurrency(step3TotalTax) }}</span>
        </div>
        <div class="payroll-card blue">
          <span class="card-label">Total Net Pay</span>
          <span class="card-value">{{ formatCurrency(step3TotalNetPay) }}</span>
        </div>
        <div class="payroll-card gray">
          <span class="card-label">Employees</span>
          <span class="card-value">{{ step3EmployeeCount }}</span>
        </div>
      </div>

      <div class="step-header">
        <h3>Step 2: Payroll Calculation Complete</h3>
        <p class="period-info">Period: {{ generateStartDate && generateEndDate ? generateStartDate + ' - ' + generateEndDate : '-' }}</p>
      </div>

      <div class="loading-indicator" *ngIf="payrollCalcLoading">
        <i class="fas fa-spinner fa-spin"></i> Calculating payroll...
      </div>

      <div class="table-container" *ngIf="!payrollCalcLoading">
        <table class="data-table payroll-calc-table-new">
          <thead>
            <tr>
              <th class="checkbox-col">
                <input type="checkbox" [checked]="allStep3Selected" (change)="toggleAllStep3Selection()" />
              </th>
              <th>S.NO</th>
              <th>EMP ID</th>
              <th>NAME</th>
              <th>TYPE</th>
              <th>HOURS</th>
              <th class="green-header">GROSS</th>
              <th>FEDERAL</th>
              <th>STATE</th>
              <th>SOC.SEC</th>
              <th>MEDICARE</th>
              <th class="red-header">TOTAL TAX</th>
              <th class="green-header">NET PAY</th>
              <th>STATUS</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let row of payrollCalculationRows" [class.selected]="row.selected">
              <td class="checkbox-col">
                <input type="checkbox" [checked]="row.selected" (change)="toggleStep3RowSelection(row)" />
              </td>
              <td>{{ row.sno }}</td>
              <td class="emp-id">{{ row.empId }}</td>
              <td class="emp-name">{{ row.name }}</td>
              <td>{{ row.type }}</td>
              <td>{{ row.hours.toFixed(2) }}h</td>
              <td class="green-text">{{ formatCurrency(row.gross) }}</td>
              <td>{{ formatCurrency(row.federal) }}</td>
              <td>{{ formatCurrency(row.state) }}</td>
              <td>{{ formatCurrency(row.socSec) }}</td>
              <td>{{ formatCurrency(row.medicare) }}</td>
              <td class="red-text">{{ formatCurrency(row.totalTax) }}</td>
              <td class="green-text">{{ formatCurrency(row.netPay) }}</td>
              <td>
                <span class="status-badge" [ngClass]="row.status === 'Calculated' ? 'approved' : 'pending'">
                  {{ row.status }}
                </span>
              </td>
            </tr>
            <tr *ngIf="payrollCalculationRows.length === 0 && !payrollCalcLoading">
              <td colspan="14" class="no-data">
                <i class="fas fa-calculator"></i>
                No payroll data. Generate timesheets first.
              </td>
            </tr>
          </tbody>
          <tfoot *ngIf="payrollCalculationRows.length > 0">
            <tr class="total-row">
              <td></td>
              <td colspan="4" class="text-right"><strong>TOTAL</strong></td>
              <td><strong>{{ step3TotalHours.toFixed(2) }}h</strong></td>
              <td class="green-text"><strong>{{ formatCurrency(step3TotalGross) }}</strong></td>
              <td><strong>{{ formatCurrency(0) }}</strong></td>
              <td><strong>{{ formatCurrency(0) }}</strong></td>
              <td><strong>{{ formatCurrency(0) }}</strong></td>
              <td><strong>{{ formatCurrency(0) }}</strong></td>
              <td class="red-text"><strong>{{ formatCurrency(step3TotalTax) }}</strong></td>
              <td class="green-text"><strong>{{ formatCurrency(step3TotalNetPay) }}</strong></td>
              <td></td>
            </tr>
          </tfoot>
        </table>
      </div>

      <div class="step-actions-bar">
        <div class="left-actions">
          <span class="selected-info">{{ getSelectedStep3Count() }} employee(s) selected</span>
        </div>
        <div class="right-actions">
          <button class="btn btn-outline-secondary" (click)="goToStep(1)">
            Back
          </button>
          <button class="btn btn-success" [disabled]="getSelectedStep3Count() === 0" (click)="processSelectedPayroll()">
            <i class="fas fa-check-circle"></i> Process Payroll
          </button>
          <button class="btn btn-primary" (click)="goToStep(3)">
            Next: Process Payroll <i class="fas fa-arrow-right"></i>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Step 4: Process Payroll -->
  <div class="step-content" *ngIf="currentStep === 3">
    <div class="section-box">
      <div class="step-header">
        <h3>Step 3: Process Payroll</h3>
        <p class="period-info">Review processed and held payroll records</p>
      </div>

      <div class="payroll-summary-cards">
        <div class="payroll-card green">
          <span class="card-label">Processed Gross</span>
          <span class="card-value">{{ formatCurrency(step4TotalProcessedGross) }}</span>
        </div>
        <div class="payroll-card blue">
          <span class="card-label">Processed Net</span>
          <span class="card-value">{{ formatCurrency(step4TotalProcessedNet) }}</span>
        </div>
        <div class="payroll-card orange">
          <span class="card-label">Hold Gross</span>
          <span class="card-value">{{ formatCurrency(step4TotalHoldGross) }}</span>
        </div>
        <div class="payroll-card gray">
          <span class="card-label">Employees</span>
          <span class="card-value">{{ processedPayrollRows.length + holdPayrollRows.length }}</span>
        </div>
      </div>

      <!-- Processed Payroll Table -->
      <div class="sub-section">
        <h4><i class="fas fa-check-circle text-success"></i> Processed Payroll</h4>
      </div>

      <div class="table-container">
        <table class="data-table payroll-calc-table-new processed-table">
          <thead>
            <tr>
              <th>S.NO</th>
              <th>EMP ID</th>
              <th>NAME</th>
              <th>TYPE</th>
              <th>HOURS</th>
              <th class="green-header">GROSS</th>
              <th>FEDERAL</th>
              <th>STATE</th>
              <th>SOC.SEC</th>
              <th>MEDICARE</th>
              <th class="red-header">TOTAL TAX</th>
              <th class="green-header">NET PAY</th>
              <th>STATUS</th>
              <th>ACTION</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let row of processedPayrollRows">
              <td>{{ row.sno }}</td>
              <td class="emp-id">{{ row.empId }}</td>
              <td class="emp-name">{{ row.name }}</td>
              <td>{{ row.type }}</td>
              <td>{{ row.hours.toFixed(2) }}h</td>
              <td class="green-text">{{ formatCurrency(row.gross) }}</td>
              <td>{{ formatCurrency(row.federal) }}</td>
              <td>{{ formatCurrency(row.state) }}</td>
              <td>{{ formatCurrency(row.socSec) }}</td>
              <td>{{ formatCurrency(row.medicare) }}</td>
              <td class="red-text">{{ formatCurrency(row.totalTax) }}</td>
              <td class="green-text">{{ formatCurrency(row.netPay) }}</td>
              <td>
                <span class="status-badge processed">{{ row.status }}</span>
              </td>
              <td>
                <div class="btn-group-actions">
                  <button class="btn btn-sm btn-success" (click)="releasePayroll(row)" title="Release to History">
                    <i class="fas fa-check-circle"></i> Release
                  </button>
                  <button class="btn btn-sm btn-warning" (click)="holdPayroll(row)" title="Hold Payroll">
                    <i class="fas fa-pause"></i> Hold
                  </button>
                </div>
              </td>
            </tr>
            <tr *ngIf="processedPayrollRows.length === 0">
              <td colspan="14" class="no-data">
                <i class="fas fa-check-circle"></i>
                No processed payroll records. Process employees from Step 2.
              </td>
            </tr>
          </tbody>
          <tfoot *ngIf="processedPayrollRows.length > 0">
            <tr class="total-row">
              <td colspan="5" class="text-right"><strong>TOTAL</strong></td>
              <td class="green-text"><strong>{{ formatCurrency(step4TotalProcessedGross) }}</strong></td>
              <td colspan="5"></td>
              <td class="green-text"><strong>{{ formatCurrency(step4TotalProcessedNet) }}</strong></td>
              <td>
                <button class="btn btn-sm btn-primary" (click)="releaseAllPayroll()" *ngIf="processedPayrollRows.length > 0" title="Release All to History">
                  <i class="fas fa-paper-plane"></i> Release All
                </button>
              </td>
            </tr>
          </tfoot>
        </table>
      </div>

      <!-- Hold Payroll Table -->
      <div class="sub-section" style="margin-top: 30px;">
        <h4><i class="fas fa-pause-circle text-warning"></i> Hold Payroll</h4>
      </div>

      <div class="table-container">
        <table class="data-table payroll-calc-table-new hold-table">
          <thead>
            <tr>
              <th>S.NO</th>
              <th>EMP ID</th>
              <th>NAME</th>
              <th>TYPE</th>
              <th>HOURS</th>
              <th class="green-header">GROSS</th>
              <th>FEDERAL</th>
              <th>STATE</th>
              <th>SOC.SEC</th>
              <th>MEDICARE</th>
              <th class="red-header">TOTAL TAX</th>
              <th class="green-header">NET PAY</th>
              <th>STATUS</th>
              <th>ACTION</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let row of holdPayrollRows">
              <td>{{ row.sno }}</td>
              <td class="emp-id">{{ row.empId }}</td>
              <td class="emp-name">{{ row.name }}</td>
              <td>{{ row.type }}</td>
              <td>{{ row.hours.toFixed(2) }}h</td>
              <td class="green-text">{{ formatCurrency(row.gross) }}</td>
              <td>{{ formatCurrency(row.federal) }}</td>
              <td>{{ formatCurrency(row.state) }}</td>
              <td>{{ formatCurrency(row.socSec) }}</td>
              <td>{{ formatCurrency(row.medicare) }}</td>
              <td class="red-text">{{ formatCurrency(row.totalTax) }}</td>
              <td class="green-text">{{ formatCurrency(row.netPay) }}</td>
              <td>
                <span class="status-badge hold">{{ row.status }}</span>
              </td>
              <td>
                <button class="btn btn-sm btn-success" (click)="releaseFromHold(row)" title="Release from Hold">
                  <i class="fas fa-play"></i> Release
                </button>
              </td>
            </tr>
            <tr *ngIf="holdPayrollRows.length === 0">
              <td colspan="14" class="no-data">
                <i class="fas fa-pause-circle"></i>
                No payroll records on hold
              </td>
            </tr>
          </tbody>
          <tfoot *ngIf="holdPayrollRows.length > 0">
            <tr class="total-row">
              <td colspan="5" class="text-right"><strong>TOTAL</strong></td>
              <td class="green-text"><strong>{{ formatCurrency(step4TotalHoldGross) }}</strong></td>
              <td colspan="5"></td>
              <td class="green-text"><strong>{{ formatCurrency(step4TotalHoldNet) }}</strong></td>
              <td colspan="2"></td>
            </tr>
          </tfoot>
        </table>
      </div>

      <div class="step-actions-bar">
        <div class="left-actions">
          <span class="selected-info">{{ processedPayrollRows.length }} processed, {{ holdPayrollRows.length }} on hold</span>
        </div>
        <div class="right-actions">
          <button class="btn btn-outline-secondary" (click)="goToStep(2)">
            Back
          </button>
          <button class="btn btn-primary" (click)="goToStep(5)">
            View Payroll History <i class="fas fa-arrow-right"></i>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Payroll Summary Section after processing -->
  <div class="payroll-summary-section" *ngIf="showPayrollSummary && currentStep === 3">
    <div class="section-box summary-box">
      <div class="summary-header">
        <h3><i class="fas fa-check-circle text-success"></i> Payroll Processed Successfully</h3>
        <button class="btn btn-sm btn-outline" (click)="closeSummary()">
          <i class="fas fa-times"></i> Close
        </button>
      </div>

      <div class="summary-stats">
        <div class="stat-item">
          <span class="stat-value">{{ processedSalariedEmployees.length + processedHourlyEmployees.length }}</span>
          <span class="stat-label">Employees Processed</span>
        </div>
        <div class="stat-item">
          <span class="stat-value">{{ formatCurrency(processedNetTotal) }}</span>
          <span class="stat-label">Net Total Amount</span>
        </div>
      </div>

      <div class="category-section" *ngIf="processedSalariedEmployees.length > 0">
        <h4><i class="fas fa-users"></i> Salaried Employees ({{ processedSalariedEmployees.length }})</h4>
        <table class="data-table summary-table">
          <thead>
            <tr>
              <th>EMP ID</th>
              <th>NAME</th>
              <th>Basic</th>
              <th>Gross</th>
              <th>Taxes</th>
              <th>Net Amount</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let emp of processedSalariedEmployees">
              <td class="emp-id">{{ emp.empId }}</td>
              <td class="emp-name">{{ emp.name }}</td>
              <td>{{ formatCurrency(emp.basic) }}</td>
              <td>{{ formatCurrency(emp.gross) }}</td>
              <td class="tax-col">{{ formatCurrency(emp.taxes) }}</td>
              <td class="net-amount">{{ formatCurrency(emp.netAmount) }}</td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="category-section" *ngIf="processedHourlyEmployees.length > 0">
        <h4><i class="fas fa-clock"></i> Hourly Employees ({{ processedHourlyEmployees.length }})</h4>
        <table class="data-table summary-table">
          <thead>
            <tr>
              <th>EMP ID</th>
              <th>NAME</th>
              <th>Basic</th>
              <th>Gross</th>
              <th>Taxes</th>
              <th>Net Amount</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let emp of processedHourlyEmployees">
              <td class="emp-id">{{ emp.empId }}</td>
              <td class="emp-name">{{ emp.name }}</td>
              <td>{{ formatCurrency(emp.basic) }}</td>
              <td>{{ formatCurrency(emp.gross) }}</td>
              <td class="tax-col">{{ formatCurrency(emp.taxes) }}</td>
              <td class="net-amount">{{ formatCurrency(emp.netAmount) }}</td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="grand-total">
        <span>Grand Total Net Amount:</span>
        <span class="total-value">{{ formatCurrency(processedNetTotal) }}</span>
      </div>
    </div>
  </div>
</div>
